import{r as t,j as e,J as Q,B as u,a as Y,F as B,T as y,C as ee,N as C}from"./app-D99SyvRR.js";import{C as n,a as f,b as N,d as L,c as l}from"./card-C4eruR7i.js";import{B as se}from"./app-header-floating-CL-WcHKV.js";import{P as ae}from"./progress-Cvpg2akL.js";import{L as v}from"./label-Ckf2DMGS.js";import{T as S}from"./textarea-DgWVgojT.js";import{A as re}from"./app-layout-OPwkLiXp.js";import{A as ie}from"./arrow-left-B6goLLZ7.js";import{U as H}from"./upload-B8RI2wTa.js";import{L as q}from"./loader-circle-COaEw8tl.js";import{B as V}from"./brain-BrhihAvb.js";import{C as P}from"./circle-check-big-CsZAs_78.js";import{S as te}from"./square-pen-x2q1PNne.js";import{S as oe}from"./save-jWmbIDzQ.js";/* empty css            */import"./index-7FwNBKjq.js";import"./index-CF2syoQW.js";import"./user-BFnnBjxc.js";import"./app-logo-icon-CfVo17qO.js";const ne=[{title:"Consulta Pacientes",href:"/medico/consulta-pacientes"},{title:"An√°lisis IA - Prueba",href:"#"}];function Ee(){const[le,ce]=t.useState({}),[o,E]=t.useState(null),[x,I]=t.useState(!1),[de,w]=t.useState(!1),[s,A]=t.useState(null),[R,i]=t.useState(""),[d,m]=t.useState(0),p=t.useRef(null),[h,T]=t.useState(""),[g,F]=t.useState(""),[b,D]=t.useState(""),[j,M]=t.useState(""),[O,G]=t.useState(!1),[J,z]=t.useState(!1),U=r=>{const a=r.target.files?.[0];if(a){if(!["application/pdf","image/jpeg","image/png","image/jpg","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(a.type)){i("Tipo de archivo no permitido. Solo se aceptan PDF, im√°genes (JPG, PNG) y documentos de Word.");return}if(a.size>10*1024*1024){i("El archivo es demasiado grande. M√°ximo 10MB permitido.");return}E(a),i("")}},X=()=>{p.current&&p.current.click()},Z=async()=>{if(!o){i("Por favor selecciona un archivo primero.");return}I(!0),w(!1),m(10),i("");try{const r=new FormData;r.append("historia_clinica",o),m(30);const a=await C.post("/medico/ai/extraer-datos-documento",r,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(m(60),w(!0),a.data.success){const _=a.data.data.texto_extraido||a.data.texto_extraido||"",k=_.length,c=await C.post("/medico/priorizacion/analizar",{datos_paciente:{...a.data.data,texto_completo_extraido:_,longitud_documento:k,solicitar_extraccion_completa:!0},config_analisis:{extraer_todos_los_datos:!0,incluir_signos_vitales:!0,incluir_sintomas:!0,incluir_diagnosticos:!0,incluir_medicamentos:!0,incluir_convenios:!0,aplicar_algoritmo_priorizacion:!0}});if(m(100),c.data&&c.data.paciente&&c.data.paciente.nombre&&c.data.resultado&&c.data.razonamiento&&c.data.razonamiento!=="Error al procesar an√°lisis con IA. Se requiere revisi√≥n manual."){const W={...c.data,texto_extraido:_,longitud_texto:k};A(W)}else throw new Error("ü§ñ La IA no pudo procesar correctamente el documento. Verifique que el archivo contenga una historia cl√≠nica v√°lida con datos del paciente.")}else throw new Error(a.data.message||"Error al procesar el archivo")}catch(r){A(null);const a=r;a.response?.status===503&&a.response?.data?.error_type==="api_overload"?i("‚ö†Ô∏è El servicio de IA est√° temporalmente sobrecargado. Por favor intenta nuevamente en unos minutos. üîÑ"):a.message?.includes("ü§ñ La IA no pudo procesar")?i(a.message):i(`‚ùå Error en el procesamiento: ${a.response?.data?.message||a.message||"Error desconocido al procesar el archivo"}

üí° Sugerencia: Verifique los logs del backend para m√°s detalles t√©cnicos.`)}finally{I(!1),w(!1),m(0)}},K=()=>{E(null),A(null),i(""),m(0),p.current&&(p.current.value="")},$=async()=>{if(!h.trim()){i("Por favor ingrese el nombre del documento.");return}if(!g.trim()||!b.trim()||!j.trim()){i("Por favor complete todos los campos de an√°lisis manual.");return}if(!s){i("Primero debe analizar un documento con la IA.");return}G(!0),i(""),z(!1);try{(await C.post("/medico/priorizacion/guardar-analisis-manual",{nombre_documento:h,nombre_archivo_original:o?.name||"",analisis_precisa:g,analisis_vital_red:b,analisis_medico:j,texto_extraido:s.texto_extraido||"",analisis_ia:JSON.stringify(s),razonamiento_priorizacion:s.razonamiento_priorizacion||null},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).data.success&&(z(!0),setTimeout(()=>{T(""),F(""),D(""),M(""),z(!1)},3e3))}catch(r){i(r.response?.data?.message||"Error al guardar el an√°lisis")}finally{G(!1)}};return e.jsxs(re,{breadcrumbs:ne,children:[e.jsx(Q,{title:"An√°lisis de Priorizaci√≥n IA - Prueba - HERMES"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 p-4 sm:gap-5 sm:p-5 md:gap-6 md:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>Y.visit("/medico/consulta-pacientes"),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-slate-900",children:"An√°lisis de Priorizaci√≥n IA"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-600",children:"Sistema de evaluaci√≥n automatizada con inteligencia artificial"})]})]}),!s&&e.jsxs(n,{className:"bg-white border-0 shadow-[0_2px_4px_rgba(0,0,0,0.06),0_8px_20px_rgba(0,0,0,0.1),inset_0_1px_0_rgba(255,255,255,1)]",children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"1. Cargar Historia Cl√≠nica o Documento M√©dico"]}),e.jsx(L,{children:"Selecciona un archivo de historia cl√≠nica para extraer datos y analizar con IA"})]}),e.jsxs(l,{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-slate-200 rounded-lg p-4 sm:p-6 md:p-8 text-center bg-slate-50/50",children:e.jsxs("div",{className:"mx-auto flex max-w-sm flex-col items-center gap-4",children:[e.jsx(B,{className:"h-12 w-12 text-muted-foreground"}),o?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"‚úÖ Archivo seleccionado:"}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:[e.jsx("p",{className:"text-sm font-medium",children:o.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tama√±o: ",(o.size/1024/1024).toFixed(2)," MB"]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Haz clic para seleccionar un archivo o arr√°stralo aqu√≠"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"PDF, JPG, PNG, DOC, DOCX (m√°x. 10MB)"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-2 w-full sm:w-auto",children:[e.jsxs(u,{onClick:X,variant:"outline",disabled:x,className:"w-full sm:w-auto touch-manipulation",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Seleccionar Archivo"]}),o&&e.jsxs(u,{onClick:Z,disabled:x,className:"w-full sm:w-auto bg-green-600 hover:bg-green-700 shadow-[0_1px_2px_rgba(0,0,0,0.1),0_2px_4px_rgba(34,197,94,0.2)] hover:shadow-[0_2px_4px_rgba(0,0,0,0.12),0_8px_16px_rgba(34,197,94,0.3)] hover:-translate-y-0.5 transition-all duration-200 touch-manipulation",children:[x?e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(V,{className:"h-4 w-4 mr-2"}),x?"Analizando...":"2. Analizar con IA"]})]}),e.jsx("input",{ref:p,type:"file",onChange:U,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.txt",className:"hidden"})]})}),x&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:[d<40&&"üìÑ Extrayendo texto del documento...",d>=40&&d<80&&"üîç Procesando informaci√≥n m√©dica...",d>=80&&"üß† Generando an√°lisis de priorizaci√≥n..."]}),e.jsxs("span",{children:[d,"%"]})]}),e.jsx(ae,{value:d,className:"h-2"})]}),R&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(y,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Error"})]}),e.jsx("p",{className:"text-sm text-red-600 mt-2",children:R})]})]})]}),s&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2 sm:gap-3 grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6",children:[e.jsx(n,{className:"sm:col-span-2 lg:col-span-2 bg-white border-0 shadow-[0_1px_2px_rgba(0,0,0,0.05),0_4px_8px_rgba(0,0,0,0.08),inset_0_1px_0_rgba(255,255,255,0.9)]",children:e.jsxs(l,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"An√°lisis OK"})]}),e.jsx(u,{onClick:K,variant:"outline",size:"sm",className:"h-7 text-xs",children:"Nuevo"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["üìÑ ",o?.name?.substring(0,30),"..."]})}),e.jsx("div",{children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["üìä ",s.longitud_texto||0," caracteres"]})})]})]})}),e.jsx(n,{className:"sm:col-span-2 lg:col-span-2 bg-white border-0 shadow-[0_1px_2px_rgba(0,0,0,0.05),0_4px_8px_rgba(0,0,0,0.08),inset_0_1px_0_rgba(255,255,255,0.9)]",children:e.jsxs(l,{className:"p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"üë§ Paciente"}),e.jsx("p",{className:"text-sm font-semibold leading-tight",children:s.paciente.nombre}),e.jsx("p",{className:"text-sm font-semibold leading-tight",children:s.paciente.apellidos})]})}),e.jsx(n,{className:"bg-white border-0 shadow-[0_1px_2px_rgba(0,0,0,0.05),0_4px_8px_rgba(0,0,0,0.08),inset_0_1px_0_rgba(255,255,255,0.9)]",children:e.jsxs(l,{className:"p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"üéÇ Edad"}),e.jsx("p",{className:"text-xl font-bold",children:s.paciente.edad}),e.jsx("p",{className:"text-xs text-slate-500",children:"a√±os"})]})}),e.jsx(n,{className:"bg-white border-0 shadow-[0_1px_2px_rgba(0,0,0,0.05),0_4px_8px_rgba(0,0,0,0.08),inset_0_1px_0_rgba(255,255,255,0.9)]",children:e.jsxs(l,{className:"p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"üë• Tipo"}),e.jsx(se,{variant:"outline",className:"text-xs",children:s.paciente.tipo_paciente})]})})]}),s.texto_extraido&&e.jsxs(n,{className:"bg-white border-0 shadow-[0_1px_2px_rgba(0,0,0,0.05),0_4px_8px_rgba(0,0,0,0.08),inset_0_1px_0_rgba(255,255,255,0.9)]",children:[e.jsx(f,{className:"pb-3",children:e.jsxs(N,{className:"text-base flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"üìã Texto Extra√≠do (",(s.longitud_texto||0).toLocaleString()," chars)"]})}),e.jsx(l,{className:"pt-0",children:e.jsx("div",{className:"bg-slate-50 border-0 rounded-lg p-3 max-h-64 overflow-y-auto shadow-[inset_0_2px_4px_rgba(0,0,0,0.06),inset_0_0_8px_rgba(0,0,0,0.04)]",children:e.jsx("pre",{className:"text-xs whitespace-pre-wrap font-mono text-muted-foreground leading-relaxed",children:s.texto_extraido})})})]}),s.razonamiento_priorizacion&&e.jsxs(n,{className:"bg-white border-0 shadow-[0_1px_2px_rgba(0,0,0,0.05),0_4px_8px_rgba(0,0,0,0.08),inset_0_1px_0_rgba(255,255,255,0.9)]",children:[e.jsx(f,{className:"pb-3",children:e.jsxs(N,{className:"text-base flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"üéØ An√°lisis de Priorizaci√≥n M√©dica"]})}),e.jsx(l,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:`inline-flex items-center gap-2 px-6 py-3 rounded-full text-lg font-bold border-2 ${s.razonamiento_priorizacion.color==="verde"?"bg-green-100 text-green-800 border-green-300":"bg-red-100 text-red-800 border-red-300"}`,children:[s.razonamiento_priorizacion.color==="verde"?e.jsx(P,{className:"h-6 w-6"}):e.jsx(ee,{className:"h-6 w-6"}),s.razonamiento_priorizacion.prioriza?"üü¢ PRIORIZA":"üî¥ NO PRIORIZA"]})}),e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg border-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"üè• Decisi√≥n Cl√≠nica:"}),e.jsx("span",{className:`font-bold text-base ${s.razonamiento_priorizacion.prioriza?"text-green-700":"text-red-700"}`,children:s.razonamiento_priorizacion.prioriza?"PRIORIZAR":"NO PRIORIZAR"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"An√°lisis basado en criterios oficiales de priorizaci√≥n m√©dica"})]}),e.jsxs("div",{className:"bg-muted/30 border rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"Razonamiento IA"]}),e.jsx("div",{className:"text-xs leading-relaxed whitespace-pre-wrap max-h-64 overflow-y-auto",children:s.razonamiento_priorizacion.razonamiento})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"text-sm font-medium text-blue-800 mb-1",children:"üîç Criterios Aplicados:"}),e.jsxs("div",{className:"text-xs text-blue-700 space-y-0.5",children:[e.jsx("p",{children:"‚úì Datos Generales (edad, instituci√≥n remitente)"}),e.jsx("p",{children:"‚úì Datos Cl√≠nicos (tipo paciente, fecha ingreso)"}),e.jsx("p",{children:"‚úì Signos Vitales (FC, FR, TA, Temperatura, SatO2, Glasgow)"}),e.jsx("p",{children:"‚úì S√≠ntomas (por tipo de paciente)"}),e.jsx("p",{children:"‚úì Servicios (UCI, urgencias, medicina general)"}),e.jsx("p",{children:"‚úì Especialidades (oncolog√≠a, trasplantes, etc.)"}),e.jsx("p",{children:"‚úì Apoyo Diagn√≥stico (procedimientos especializados)"}),e.jsx("p",{children:"‚úì Convenios (evaluado al final)"})]})]})]})})]})]}),s&&e.jsxs(n,{className:"border-2 border-blue-200 bg-blue-50/30",children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(te,{className:"h-5 w-5"}),"üìù Campos de An√°lisis Manual"]}),e.jsx(L,{className:"text-blue-700",children:"Complete estos campos para registrar su an√°lisis manual y compararlo con el an√°lisis de la IA"})]}),e.jsxs(l,{className:"space-y-4",children:[J&&e.jsx("div",{className:"bg-green-100 border border-green-300 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx(P,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"¬°An√°lisis guardado exitosamente!"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"nombre_documento",className:"text-blue-900 font-medium",children:"Nombre del Documento / Historia Cl√≠nica *"}),e.jsx("input",{id:"nombre_documento",type:"text",value:h,onChange:r=>T(r.target.value),placeholder:"Ej: HC-12345 - Juan P√©rez",className:"w-full mt-2 px-4 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Archivo cargado: ",o?.name||"Sin archivo"]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"analisis_precisa",className:"text-blue-900 font-medium",children:"1. An√°lisis Precisa *"}),e.jsx(S,{id:"analisis_precisa",value:g,onChange:r=>F(r.target.value),placeholder:"Ingrese su an√°lisis desde la perspectiva de Precisa...",className:"mt-2 min-h-[100px] border-blue-300 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"analisis_vital_red",className:"text-blue-900 font-medium",children:"2. An√°lisis HERMES *"}),e.jsx(S,{id:"analisis_vital_red",value:b,onChange:r=>D(r.target.value),placeholder:"Ingrese su an√°lisis desde la perspectiva de HERMES...",className:"mt-2 min-h-[100px] border-blue-300 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"analisis_medico",className:"text-blue-900 font-medium",children:"3. An√°lisis M√©dico *"}),e.jsx(S,{id:"analisis_medico",value:j,onChange:r=>M(r.target.value),placeholder:"Ingrese su an√°lisis m√©dico profesional...",className:"mt-2 min-h-[100px] border-blue-300 focus:ring-blue-500"})]}),e.jsx(u,{onClick:$,disabled:O||!h.trim()||!g.trim()||!b.trim()||!j.trim(),className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-6 text-lg",children:O?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-5 w-5 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-5 w-5 mr-2"}),"Guardar An√°lisis Manual"]})}),e.jsx("div",{className:"bg-blue-100 border border-blue-300 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["üí° ",e.jsx("strong",{children:"Nota:"})," Los datos guardados se almacenar√°n temporalmente para an√°lisis y comparaci√≥n con los resultados de la IA."]})})]})]})]}),e.jsx(n,{className:"border-dashed border-2 border-yellow-200 bg-yellow-50/50",children:e.jsxs(l,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800 mb-2",children:[e.jsx(y,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Vista Temporal de Prueba"})]}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Esta vista est√° dise√±ada para evaluar la efectividad del algoritmo de priorizaci√≥n IA. Una vez validado su correcto funcionamiento, esta interfaz ser√° reemplazada por la integraci√≥n directa en el sistema principal."})]})})]})]})}export{Ee as default};
