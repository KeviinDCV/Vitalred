import{r as o,j as e,J as B,B as j,a as O,F as C,T as b,C as k,N as y}from"./app-C2iDTuTN.js";import{C as p,a as g,b as f,d as z,c as u}from"./card-Bx9vz5lL.js";import{B as L}from"./app-header-floating-CxMkFEgg.js";import{P as M}from"./progress-C4BURrTd.js";import{A as V}from"./app-layout-Ba_vSkmF.js";import{A as G}from"./arrow-left-BI5XMkWv.js";import{U as P}from"./upload-CaMQ8luM.js";import{L as q}from"./loader-circle-DZylS1s7.js";import{B as E}from"./brain-DPxPK01Q.js";import{C as I}from"./circle-check-big-C3gLjXnD.js";/* empty css            */import"./index-DFo9P-5L.js";import"./index-CXhS-UtD.js";import"./user-0Jdvfuuw.js";import"./app-logo-icon-D1cblqZD.js";const H=[{title:"Consulta Pacientes",href:"/medico/consulta-pacientes"},{title:"An√°lisis IA - Prueba",href:"#"}];function le(){const[Z,J]=o.useState({}),[n,A]=o.useState(null),[m,w]=o.useState(!1),[U,N]=o.useState(!1),[s,v]=o.useState(null),[_,i]=o.useState(""),[c,l]=o.useState(0),x=o.useRef(null),S=d=>{const a=d.target.files?.[0];if(a){if(!["application/pdf","image/jpeg","image/png","image/jpg","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(a.type)){i("Tipo de archivo no permitido. Solo se aceptan PDF, im√°genes (JPG, PNG) y documentos de Word.");return}if(a.size>10*1024*1024){i("El archivo es demasiado grande. M√°ximo 10MB permitido.");return}A(a),i("")}},R=()=>{x.current&&x.current.click()},D=async()=>{if(!n){i("Por favor selecciona un archivo primero.");return}w(!0),N(!1),l(10),i("");try{const d=new FormData;d.append("historia_clinica",n),l(30);const a=await y.post("/medico/ai/extraer-datos-documento",d,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(l(60),N(!0),a.data.success){const t=a.data.data.texto_extraido||a.data.texto_extraido||"",h=t.length,r=await y.post("/medico/priorizacion/analizar",{datos_paciente:{...a.data.data,texto_completo_extraido:t,longitud_documento:h,solicitar_extraccion_completa:!0},config_analisis:{extraer_todos_los_datos:!0,incluir_signos_vitales:!0,incluir_sintomas:!0,incluir_diagnosticos:!0,incluir_medicamentos:!0,incluir_convenios:!0,aplicar_algoritmo_priorizacion:!0}});if(l(100),r.data&&r.data.paciente&&r.data.paciente.nombre&&r.data.resultado&&r.data.razonamiento&&r.data.razonamiento!=="Error al procesar an√°lisis con IA. Se requiere revisi√≥n manual."){const F={...r.data,texto_extraido:t,longitud_texto:h};v(F)}else throw new Error("ü§ñ La IA no pudo procesar correctamente el documento. Verifique que el archivo contenga una historia cl√≠nica v√°lida con datos del paciente.")}else throw new Error(a.data.message||"Error al procesar el archivo")}catch(d){v(null);const a=d,t=a?.message||"Error desconocido",h=a?.response?.status,r=a?.response?.data;h===503&&r?.error_type==="api_overload"?i("‚ö†Ô∏è El servicio de IA est√° temporalmente sobrecargado. Por favor intenta nuevamente en unos minutos. üîÑ"):t.includes("ü§ñ La IA no pudo procesar")?i(t):i(`‚ùå Error en el procesamiento: ${r?.message||t}

üí° Sugerencia: Verifique los logs del backend para m√°s detalles t√©cnicos.`)}finally{w(!1),N(!1),l(0)}},T=()=>{A(null),v(null),i(""),l(0),x.current&&(x.current.value="")};return e.jsxs(V,{breadcrumbs:H,children:[e.jsx(B,{title:"An√°lisis de Priorizaci√≥n IA - Prueba - HERMES"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>O.visit("/medico/consulta-pacientes"),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"An√°lisis de Priorizaci√≥n IA"}),e.jsx("p",{className:"text-muted-foreground",children:"Vista temporal para evaluaci√≥n del algoritmo de priorizaci√≥n"})]})]})}),!s&&e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"1. Cargar Historia Cl√≠nica o Documento M√©dico"]}),e.jsx(z,{children:"Selecciona un archivo de historia cl√≠nica para extraer datos y analizar con IA"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:e.jsxs("div",{className:"mx-auto flex max-w-sm flex-col items-center gap-4",children:[e.jsx(C,{className:"h-12 w-12 text-muted-foreground"}),n?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"‚úÖ Archivo seleccionado:"}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:[e.jsx("p",{className:"text-sm font-medium",children:n.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tama√±o: ",(n.size/1024/1024).toFixed(2)," MB"]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Haz clic para seleccionar un archivo o arr√°stralo aqu√≠"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"PDF, JPG, PNG, DOC, DOCX (m√°x. 10MB)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{onClick:R,variant:"outline",disabled:m,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Seleccionar Archivo"]}),n&&e.jsxs(j,{onClick:D,disabled:m,className:"bg-green-600 hover:bg-green-700",children:[m?e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(E,{className:"h-4 w-4 mr-2"}),m?"Analizando...":"2. Analizar con IA"]})]}),e.jsx("input",{ref:x,type:"file",onChange:S,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.txt",className:"hidden"})]})}),m&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:[c<40&&"üìÑ Extrayendo texto del documento...",c>=40&&c<80&&"üîç Procesando informaci√≥n m√©dica...",c>=80&&"üß† Generando an√°lisis de priorizaci√≥n..."]}),e.jsxs("span",{children:[c,"%"]})]}),e.jsx(M,{value:c,className:"h-2"})]}),_&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(b,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Error"})]}),e.jsx("p",{className:"text-sm text-red-600 mt-2",children:_})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"üìã Instrucciones:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Paso 1:"})," Selecciona un archivo de historia cl√≠nica (PDF, imagen o documento)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Paso 2:"})," La IA extraer√° autom√°ticamente los datos m√©dicos relevantes"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Paso 3:"})," Se analizar√°n los 8 criterios de priorizaci√≥n m√©dica"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Resultado:"})," Recibir√°s an√°lisis completo Verde/Rojo con desglose detallado"]})]})]})]})]}),s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-green-600"}),"‚úÖ An√°lisis IA Completado"]}),e.jsx(j,{onClick:T,variant:"outline",size:"sm",children:"Analizar Nuevo Archivo"})]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"üìÑ Archivo procesado"}),e.jsx("p",{className:"font-medium",children:n?.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"üë§ Paciente extra√≠do"}),e.jsxs("p",{className:"font-medium",children:[s.paciente.nombre," ",s.paciente.apellidos]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"üéÇ Edad"}),e.jsxs("p",{className:"font-medium",children:[s.paciente.edad," a√±os"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"üë• Tipo"}),e.jsx(L,{variant:"outline",children:s.paciente.tipo_paciente})]})]})})]}),s.texto_extraido&&e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"üìã Texto Extra√≠do del Documento"]}),e.jsxs(z,{children:["Texto completo extra√≠do del archivo (",s.longitud_texto||0," caracteres)"]})]}),e.jsxs(u,{children:[e.jsx("div",{className:"bg-muted/30 border rounded-lg p-4 max-h-96 overflow-y-auto",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap font-mono text-muted-foreground leading-relaxed",children:s.texto_extraido})}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["üìä Longitud: ",s.longitud_texto||0," caracteres"]}),e.jsx("span",{children:"üìÑ P√°ginas: Todas las p√°ginas procesadas"}),e.jsx("span",{children:"‚úÖ Estado: Extracci√≥n completa"})]})]})]}),s.razonamiento_priorizacion&&e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"üéØ An√°lisis de Priorizaci√≥n M√©dica"]}),e.jsx(z,{children:"An√°lisis basado en los 8 criterios espec√≠ficos de priorizaci√≥n"})]}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:`inline-flex items-center gap-3 px-8 py-4 rounded-full text-xl font-bold border-2 ${s.razonamiento_priorizacion.color==="verde"?"bg-green-100 text-green-800 border-green-300":"bg-red-100 text-red-800 border-red-300"}`,children:[s.razonamiento_priorizacion.color==="verde"?e.jsx(I,{className:"h-8 w-8"}):e.jsx(k,{className:"h-8 w-8"}),s.razonamiento_priorizacion.prioriza?"üü¢ PRIORIZA":"üî¥ NO PRIORIZA"]})}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:"üè• Decisi√≥n Cl√≠nica:"}),e.jsx("span",{className:`font-bold text-lg ${s.razonamiento_priorizacion.prioriza?"text-green-700":"text-red-700"}`,children:s.razonamiento_priorizacion.prioriza?"PRIORIZAR":"NO PRIORIZAR"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("p",{children:"‚Ä¢ An√°lisis basado en criterios oficiales de priorizaci√≥n m√©dica"}),e.jsx("p",{children:"‚Ä¢ Evaluaci√≥n integral considerando factores de riesgo y urgencia cl√≠nica"})]})]}),e.jsxs("div",{className:"bg-muted/30 border rounded-lg p-6",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),"Razonamiento Detallado de la IA"]}),e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap max-h-96 overflow-y-auto",children:s.razonamiento_priorizacion.razonamiento}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2 pt-2 border-t",children:["üìù Caracteres: ",s.razonamiento_priorizacion.razonamiento?.length||0]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"üîç Criterios de Evaluaci√≥n Aplicados:"}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("p",{children:"‚úì Datos Generales (edad, instituci√≥n remitente)"}),e.jsx("p",{children:"‚úì Datos Cl√≠nicos (tipo paciente, fecha ingreso)"}),e.jsx("p",{children:"‚úì Signos Vitales (FC, FR, TA, Temperatura, SatO2, Glasgow)"}),e.jsx("p",{children:"‚úì S√≠ntomas (por tipo de paciente)"}),e.jsx("p",{children:"‚úì Servicios (UCI, urgencias, medicina general)"}),e.jsx("p",{children:"‚úì Especialidades (oncolog√≠a, trasplantes, etc.)"}),e.jsx("p",{children:"‚úì Apoyo Diagn√≥stico (procedimientos especializados)"}),e.jsx("p",{children:"‚úì Convenios (evaluado al final)"})]})]})]})})]})]}),e.jsx(p,{className:"border-dashed border-2 border-yellow-200 bg-yellow-50/50",children:e.jsxs(u,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800 mb-2",children:[e.jsx(b,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"üöß Vista Temporal de Prueba"})]}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["Esta funcionalidad permite cargar y analizar historias cl√≠nicas reales con IA. El sistema extrae autom√°ticamente los datos m√©dicos del documento y aplica el algoritmo de priorizaci√≥n para determinar la urgencia del caso.",e.jsx("br",{}),e.jsx("strong",{children:"Flujo:"})," 1Ô∏è‚É£ Cargar archivo ‚Üí 2Ô∏è‚É£ Extraer texto ‚Üí 3Ô∏è‚É£ Analizar con IA ‚Üí 4Ô∏è‚É£ Resultado Verde/Rojo"]})]})})]})]})}export{le as default};
