import{r as t,j as e,J as B,B as h,a as D,F,T as N,C as _,N as w}from"./app-UDAP9ZxG.js";import{C as x,a as u,b as j,d as k,c as p}from"./card-Ds2ubhTi.js";import{B as y}from"./app-header-floating-Cd8IZwRc.js";import{P as C}from"./progress-D2Ho7ZZ5.js";import{A as L}from"./app-layout-CUMuWzsi.js";import{A as M}from"./arrow-left-BUmOekxj.js";import{U as z}from"./upload-fdqbXfW3.js";import{L as O}from"./loader-circle-DVov_sv7.js";import{B as P}from"./brain-DUb6ZLoZ.js";import{C as E}from"./circle-check-big-DRDcgQB5.js";/* empty css            */import"./index-Dnuv90eP.js";import"./index-LU-adX0W.js";import"./user-C3kezsfK.js";import"./app-logo-icon-CJEGrjYM.js";const G=[{title:"Consulta Pacientes",href:"/medico/consulta-pacientes"},{title:"Análisis IA con Carga de Archivo",href:"#"}];function ie(){const[r,v]=t.useState(null),[o,b]=t.useState(!1),[H,g]=t.useState(!1),[s,f]=t.useState(null),[A,i]=t.useState(""),[l,n]=t.useState(0),d=t.useRef(null),S=c=>{const a=c.target.files?.[0];if(a){if(!["application/pdf","image/jpeg","image/png","image/jpg","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(a.type)){i("Tipo de archivo no permitido. Solo se aceptan PDF, imágenes (JPG, PNG) y documentos de Word.");return}if(a.size>10*1024*1024){i("El archivo es demasiado grande. Máximo 10MB permitido.");return}v(a),i(""),f(null)}},I=()=>{d.current&&d.current.click()},R=async()=>{if(!r){i("Por favor selecciona un archivo primero.");return}b(!0),g(!1),n(10),i("");try{const c=new FormData;c.append("historia_clinica",r),n(30);const a=await w.post("/medico/ai/extraer-datos-documento",c,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(n(60),g(!0),a.data.success){const m=await w.post("/medico/priorizacion/analizar",{datos_paciente:a.data.data});if(n(100),m.data)f(m.data);else throw new Error("No se pudo completar el análisis de priorización")}else throw new Error(a.data.message||"Error al procesar el archivo")}catch(c){const a=c,m=a?.response?.data?.message||a?.message||"Error desconocido al procesar el archivo";i(m)}finally{b(!1),g(!1),n(0)}},T=()=>{v(null),f(null),i(""),n(0),d.current&&(d.current.value="")};return e.jsxs(L,{breadcrumbs:G,children:[e.jsx(B,{title:"Análisis IA con Carga de Archivo - HERMES"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>D.visit("/medico/consulta-pacientes"),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Análisis de Priorización IA"}),e.jsx("p",{className:"text-muted-foreground",children:"Carga una historia clínica y obtén el análisis de priorización"})]})]})}),!s&&e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Cargar Historia Clínica"]}),e.jsx(k,{children:"Selecciona un archivo de historia clínica para analizar con IA"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:e.jsxs("div",{className:"mx-auto flex max-w-sm flex-col items-center gap-4",children:[e.jsx(F,{className:"h-12 w-12 text-muted-foreground"}),r?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Archivo seleccionado:"}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:[e.jsx("p",{className:"text-sm font-medium",children:r.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tamaño: ",(r.size/1024/1024).toFixed(2)," MB"]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Haz clic para seleccionar un archivo o arrástralo aquí"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"PDF, JPG, PNG, DOC, DOCX (máx. 10MB)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{onClick:I,variant:"outline",disabled:o,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Seleccionar Archivo"]}),r&&e.jsxs(h,{onClick:R,disabled:o,className:"bg-green-600 hover:bg-green-700",children:[o?e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(P,{className:"h-4 w-4 mr-2"}),o?"Analizando...":"Analizar con IA"]})]}),e.jsx("input",{ref:d,type:"file",onChange:S,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.txt",className:"hidden"})]})}),o&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Procesando archivo..."}),e.jsxs("span",{children:[l,"%"]})]}),e.jsx(C,{value:l,className:"h-2"}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l<40&&"Extrayendo datos del documento...",l>=40&&l<80&&"Procesando información médica...",l>=80&&"Generando análisis de priorización..."]})})]}),A&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(N,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Error"})]}),e.jsx("p",{className:"text-sm text-red-600 mt-2",children:A})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Instrucciones:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Selecciona un archivo de historia clínica (PDF, imagen o documento)"}),e.jsx("li",{children:"• La IA extraerá automáticamente los datos médicos relevantes"}),e.jsx("li",{children:"• Se analizarán los 8 criterios de priorización médica"}),e.jsx("li",{children:"• Recibirás un análisis completo con recomendación de priorización"})]})]})]})]}),s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-green-600"}),"Análisis Completado"]}),e.jsx(h,{onClick:T,variant:"outline",size:"sm",children:"Nuevo Análisis"})]})}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Archivo analizado"}),e.jsx("p",{className:"font-medium",children:r?.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paciente"}),e.jsxs("p",{className:"font-medium",children:[s.paciente.nombre," ",s.paciente.apellidos]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Edad"}),e.jsxs("p",{className:"font-medium",children:[s.paciente.edad," años"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tipo de paciente"}),e.jsx(y,{variant:"outline",children:s.paciente.tipo_paciente})]})]})})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Resultado del Análisis IA"]})}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:`inline-flex items-center gap-2 px-6 py-3 rounded-full text-lg font-bold ${s.resultado.prioriza?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"}`,children:[s.resultado.prioriza?e.jsx(E,{className:"h-6 w-6"}):e.jsx(_,{className:"h-6 w-6"}),s.resultado.prioriza?"PRIORIZA":"NO PRIORIZA"]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Puntuación Total"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl font-bold",children:s.resultado.puntuacion_total}),e.jsxs("span",{className:"text-muted-foreground",children:["/ ",s.resultado.puntuacion_maxima]})]}),e.jsx(C,{value:s.resultado.porcentaje,className:"mt-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.resultado.porcentaje.toFixed(1),"% del máximo posible"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Nivel de Prioridad"}),e.jsx(y,{variant:"outline",className:`text-lg px-4 py-2 ${s.resultado.nivel_prioridad==="ALTA"?"bg-red-100 text-red-800 border-red-200":s.resultado.nivel_prioridad==="MEDIA"?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-gray-100 text-gray-800 border-gray-200"}`,children:s.resultado.nivel_prioridad}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Fecha de análisis: ",new Date(s.fecha_analisis).toLocaleString("es-ES")]})]})]})})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Razonamiento del Algoritmo"]})}),e.jsx(p,{children:e.jsx("div",{className:"bg-muted/50 p-4 rounded-lg",children:e.jsx("p",{className:"text-sm leading-relaxed",children:s.razonamiento})})})]})]}),e.jsx(x,{className:"border-dashed border-2 border-yellow-200 bg-yellow-50/50",children:e.jsxs(p,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800 mb-2",children:[e.jsx(N,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Vista Temporal de Prueba"})]}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Esta funcionalidad permite cargar y analizar historias clínicas reales con IA. El sistema extrae automáticamente los datos médicos del documento y aplica el algoritmo de priorización para determinar la urgencia del caso."})]})})]})]})}export{ie as default};
